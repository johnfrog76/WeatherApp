<template>
  <require from="./app.css"></require>
  <require from="./components/header/header"></require>
  <require from="./components/empty-message/empty-message"></require>
  <require from="./components/loading/loading"></require>
  <require from="./components/temp-toggle/temp-toggle"></require>
  <header></header>

  <div class="modal fade" class.bind="showModal ? 'show' : ''" tabindex="-1" click.delegate="hideModal()" data-dismiss="modal">
    <div class="modal" class.bind="showModal ? 'show' : ''"  tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Weather for ${currentItem.dt_txt}</h5>
            <button type="button" class="close" click.delegate="hideModal()" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="current-condition"> 
              <div class="weather">
                <h1 class="weather-title">${city} | ${currentItem.weather[0].main}
                  <span class="fa fa-sun" if.bind="currentItem.weather[0].main === 'Clear'"></span>
                  <span class="fa fa-cloud" if.bind="currentItem.weather[0].main === 'Clouds'"></span>
                  <span class="fa fa-tint" if.bind="currentItem.weather[0].main === 'Rain'"></span>
                  <span class="fa fa-snowflake" if.bind="currentItem.weather[0].main === 'Snow'"></span>
                </h1>
                <span if.bind="!showCelsius" class="fahrenheit">${ (1.8*(currentItem.main.temp - 273) + 32).toFixed(0)} &deg;F</span>
                <span if.bind="showCelsius" class="celcius">${ (currentItem.main.temp - 273.15).toFixed(0) } &deg;C</span>
              </div>
            </div>
            <ul class="current-condition-list">
              <li>humidity: <span>${currentItem.main.humidity} %</span></li>
              <li>feels_like: <span>${currentItem.main.feels_like}</span>
              </li>
              <li>grnd_level: <span>${currentItem.main.grnd_level}</span></li>
              <li>pressure: <span>${currentItem.main.pressure}</span></li>
              <li>sea_level: <span>${currentItem.main.sea_level}</span></li>
              <li>temp_max: <span>${currentItem.main.temp_max}</span></li>
              <li>temp_min: <span>${currentItem.main.temp_min}</span></li> 
              <li>wind direction: <span>${currentItem.wind.deg}</span>
                <span>${getWindDirection(currentItem.wind.deg)}</span>
                <span class="fa fa-arrow-right" style.bind="'transform: rotate(' + (90 + currentItem.wind.deg) +'deg)'"></span>
              </li>
              <li>wind gust: <span>${currentItem.wind.gust}</span></li>
              <li>wind speed: <span>${currentItem.wind.speed}</span></li>  
            </ul>
  
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" click.delegate="hideModal()" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col col-12">
        <form class="d-flex justify-content-center align-items-center" submit.delegate = "forecast()" _lpchecked="1">
          <button class="btn btn-secondary mr-2" type="button" click.delegate="clearField($event)">Clear</button>
          <div class="suggest-city-control">
            <input class="form-control" type="text" value.bind="queryCity" keyup.trigger="queryCities($event)" placeholder="search cities">
            <div class="dropdown-menu show" if.bind="queryResults.length > 0 && queryCity.length > 0 && queryCity !== city" class="results">
              <span class="tabstop sr-only" id="tabstop1" keyup.trigger="trapKeys($event)" tabindex="0"></span>
              <button repeat.for="result of queryResults" 
                click.delegate="selectQueryCity($event)"
                keyup.trigger="trapKeys($event)"
                id="city-search-result-${$index}"
                class="btn btn-link">
                <span class="query-city">${result.city}</span>, <span class="query-state">${result.state}</span>
              </button>
              <span class="tabstop sr-only" id="tabstop2" keyup.trigger="trapKeys($event)" tabindex="0"></span>
            </div>
          </div>
          <button class="btn btn-primary ml-2" disabled.bind="queryCity !== city || city === ''" type="submit">Search</button>
        </form>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-center align-items-center container">
    <loading if.bind="isLoading"></loading>
    <table class="table table-hover" if.bind="!isLoading">
      <thead>
        <tr class="table-primary">
          <th scope="col">Date and Time</th>
          <th scope="col">
            <temp-toggle celcius.bind="showCelsius" handleclick.call="toggleTempFormat()"></temp-toggle>
          </th>
          <th scope="col">Humidity %</th>
          <th scope="col">Weather</th>
        </tr>
      </thead>
      <tbody>
        <tr if.bind="forcastlist.length === 0">
            <td colspan="4">
              <empty-message class="empty-message" showmore.bind="emptyMesasageMore" message.bind="emptyMessage"></empty-message>
            </td>
        </tr>
        <tr tabindex="0" class="table" repeat.for="item of forcastlist" keydown.delegate="handleModal($event, $index)" click.delegate="displayModal($index)">
          <td scope="row" click.delegate="display">${item.dt_txt}</td>
          <td>
            <span if.bind="!showCelsius" class="fahrenheit">${ (1.8*(item.main.temp - 273) + 32).toFixed(0)}</span>
            <span if.bind="showCelsius" class="celcius">${ (item.main.temp - 273.15).toFixed(0) }</span>
          </td>
          <td>${item.main.humidity}</td>
          <td>
            <span class="fa fa-sun" if.bind="item.weather[0].main === 'Clear'"></span>
            <span class="fa fa-cloud" if.bind="item.weather[0].main === 'Clouds'"></span>
            <span class="fa fa-tint" if.bind="item.weather[0].main === 'Rain'"></span>
            <span class="fa fa-snowflake" if.bind="item.weather[0].main === 'Snow'"></span>
            <span class="ml-2">${item.weather[0].main}</span>
          </td>
        </tr>
      </tbody>
    </table> 
  </div>
</template>
